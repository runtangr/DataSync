# -*- coding: utf-8 -*-
__author__ = "Sommily"
sql = """
SELECT 
      CASE X.TRADE_MKT_REF WHEN 1 THEN 'SZ' WHEN 2 THEN 'SH' END + X.STOCKCODE AS Obj,
      CONVERT(VARCHAR(12),A.ENDDATE,112) AS 'Date',QKTZ20160429.dbo.Date2Str( A.ENDDATE ) AS II_Date,
      '万元' AS dw,
      A.B100000/10000 AS zzc,
      A.B110101/10000 AS hbzj,
      A.B112201/10000 AS jyxjrzc,
      A.B130101/10000 AS gdzcje,
      A.B120801/10000 AS kgcsjrzc,
      A.B140101/10000 AS wxzc,
      A.B200000/10000 AS zfz,
      A.B300000/10000 AS gdqy,
      A.B310201/10000 AS zbgjj,
      A.B310701/10000 AS wfplr,
      CASE RPT_SRC WHEN '第一季度报' THEN 10
		   WHEN '中报' THEN 20
		   WHEN '第三季度报' THEN 30
		   WHEN '年报' THEN 40
		   WHEN '申报稿' THEN 50
		   WHEN '招股说明书' THEN 60
		   WHEN '上市公告书' THEN 70
		   WHEN '第一季度报' THEN 90
		   ELSE 90 END AS bgfldm 
FROM STK_CODE X with(nolock)
  INNER JOIN STK_BALA_GEN A with(nolock) ON X.COMCODE = A.COMCODE AND X.STOCKCODE = '{STOCKCODE}'
WHERE A.RPT_TYPE='合并' AND A.ENDDATE>=CAST(YEAR(GETDATE())-3 AS VARCHAR) +'-01-01'
  AND A.RPT_DATE = (SELECT MAX(RPT_DATE) FROM STK_BALA_GEN
                      WHERE COMCODE = A.COMCODE AND ENDDATE = A.ENDDATE AND RPT_TYPE = A.RPT_TYPE)
  AND A.ISVALID=1 
ORDER BY A.ENDDATE DESC"""